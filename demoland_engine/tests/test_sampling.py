import demoland_engine
import pandas as pd


def test_get_signature_values():
    exvars, jobs_diff, gs = demoland_engine.sampling.get_signature_values("E00042707")
    pd.testing.assert_series_equal(
        pd.Series(
            [
                415,
                0.028774322534445673,
                4.017801638226956,
                3.8701114371069707,
                33.51526626147097,
                8.821759988320991,
                26.43221403186908,
                83.0509684443241,
                15.597812197578605,
                0.15275219762932124,
                0.8472478114856071,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                1126.5416985148177,
                0.0,
                0.3439532320661841,
                9.728810790838905,
                9.146851562987191,
                0.8274850240769737,
                26.384958905231514,
                7.512917120551962,
                22.76763659982221,
                3338.8750777891505,
                0.43590846138222333,
                0.9374406825162273,
                0.3041133082048803,
                3.620754745612726,
                7.167623875864575,
                19.630545369482405,
                0.030320813504529594,
                27.321331083800985,
                21.703348785257713,
                3.487739641155214,
                0.3175998054672888,
                105.73915845632041,
                0.9414931217182482,
                1714.843867575191,
                3.14880034449743,
                0.8405837772551811,
                0.09673873394407001,
                0.06267748792763357,
                3.567415614587527e-06,
                52.26930224815078,
                0.04906032806427439,
                0.03845268551945654,
                7.966571423274107,
                14238.261499504308,
                0.0591695923238115,
                13.281693782239579,
                59.85880282929249,
                9567.562710935568,
                0.41199786357896756,
                0.9068365895073707,
                22.31343622335989,
                0.025662291618596556,
                0.0009580881791989017,
            ],
            dtype=object,
            index=[
                "population_estimate",
                "A, B, D, E. Agriculture, energy and water",
                "C. Manufacturing",
                "F. Construction",
                "G, I. Distribution, hotels and restaurants",
                "H, J. Transport and communication",
                "K, L, M, N. Financial, real estate, professional and administrative activities",
                "O,P,Q. Public administration, education and health",
                "R, S, T, U. Other",
                "Land cover [Discontinuous urban fabric]",
                "Land cover [Continuous urban fabric]",
                "Land cover [Non-irrigated arable land]",
                "Land cover [Industrial or commercial units]",
                "Land cover [Green urban areas]",
                "Land cover [Pastures]",
                "Land cover [Sport and leisure facilities]",
                "sdbAre",
                "sdbCoA",
                "ssbCCo",
                "ssbCor",
                "ssbSqu",
                "ssbERI",
                "ssbCCM",
                "ssbCCD",
                "stbOri",
                "sdcAre",
                "sscCCo",
                "sscERI",
                "sicCAR",
                "stbCeA",
                "mtbAli",
                "mtbNDi",
                "mtcWNe",
                "ltbIBD",
                "sdsSPW",
                "sdsSWD",
                "sdsSPO",
                "sdsLen",
                "sssLin",
                "ldsMSL",
                "mtdDeg",
                "linP3W",
                "linP4W",
                "linPDE",
                "lcnClo",
                "ldsCDL",
                "xcnSCl",
                "linWID",
                "stbSAl",
                "sdsAre",
                "sisBpM",
                "misCel",
                "ltcRea",
                "ldeAre",
                "lseCCo",
                "lseERI",
                "lteOri",
                "lteWNB",
                "lieWCe",
            ],
            name="E00042707",
        ),
        exvars,
    )
    assert jobs_diff == 0.0
    assert gs == 0


def test_get_signature_values_custom():
    exvars, jobs_diff, gs = demoland_engine.sampling.get_signature_values(
        "E00042707",
        signature_type=3,
        use=0.2,
        greenspace=0.1,
        job_types=0.4,
        random_seed=0,
    )
    pd.testing.assert_series_equal(
        pd.Series(
            [
                184.5497825007163,
                1.6186300004685363,
                13.052174092817856,
                16.55190606413007,
                17.600288103049408,
                10.05723114084252,
                8.393244283037664,
                19.12671658246833,
                4.548938712489014,
                0.9037466061654682,
                0.0,
                0.0,
                0.0,
                0.1,
                0.0,
                0.0,
                162.94256328646836,
                0.0,
                0.5106635286251512,
                4.0,
                0.057928351915275234,
                1.0000109211397885,
                10.016837063368175,
                0.003533856964672525,
                24.69578738646922,
                1188.2113810978715,
                0.480795145063577,
                0.9744977421708139,
                0.1629935392164959,
                4.426744625958392,
                4.548672128000599,
                19.110815449367433,
                0.03354019518464397,
                28.103548548757733,
                29.435709721334014,
                3.2971847855880165,
                0.5034253935946177,
                143.42757021093462,
                0.9871838664696098,
                1942.4895057942063,
                3.0,
                0.7607996093986651,
                0.03627890463630956,
                0.194860725008158,
                1.4996275775413646e-06,
                212.46469777497276,
                0.0,
                0.0292640659266912,
                6.668841870118837,
                21793.834804365666,
                0.06949339879101127,
                24.57835901702961,
                39.427482751717534,
                116805.89807925367,
                0.39123723748300454,
                0.8393019445961084,
                25.746119970881395,
                0.0035636135637172684,
                0.0006419851109796192,
            ],
            dtype=float,
            index=[
                "population_estimate",
                "A, B, D, E. Agriculture, energy and water",
                "C. Manufacturing",
                "F. Construction",
                "G, I. Distribution, hotels and restaurants",
                "H, J. Transport and communication",
                "K, L, M, N. Financial, real estate, professional and administrative activities",
                "O,P,Q. Public administration, education and health",
                "R, S, T, U. Other",
                "Land cover [Discontinuous urban fabric]",
                "Land cover [Continuous urban fabric]",
                "Land cover [Non-irrigated arable land]",
                "Land cover [Industrial or commercial units]",
                "Land cover [Green urban areas]",
                "Land cover [Pastures]",
                "Land cover [Sport and leisure facilities]",
                "sdbAre",
                "sdbCoA",
                "ssbCCo",
                "ssbCor",
                "ssbSqu",
                "ssbERI",
                "ssbCCM",
                "ssbCCD",
                "stbOri",
                "sdcAre",
                "sscCCo",
                "sscERI",
                "sicCAR",
                "stbCeA",
                "mtbAli",
                "mtbNDi",
                "mtcWNe",
                "ltbIBD",
                "sdsSPW",
                "sdsSWD",
                "sdsSPO",
                "sdsLen",
                "sssLin",
                "ldsMSL",
                "mtdDeg",
                "linP3W",
                "linP4W",
                "linPDE",
                "lcnClo",
                "ldsCDL",
                "xcnSCl",
                "linWID",
                "stbSAl",
                "sdsAre",
                "sisBpM",
                "misCel",
                "ltcRea",
                "ldeAre",
                "lseCCo",
                "lseERI",
                "lteOri",
                "lteWNB",
                "lieWCe",
            ],
            name="E00042707",
        ),
        exvars,
    )
    assert jobs_diff == -84.38557934212872
    assert gs == 6638.863416049736
